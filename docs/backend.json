{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the BalanceView application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "monthlyIncome": {
          "type": "number",
          "description": "The user's monthly income in GBP."
        }
      },
      "required": [
        "id",
        "monthlyIncome"
      ]
    },
    "Bill": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Bill",
      "type": "object",
      "description": "Represents a recurring bill for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Bill entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Bill)"
        },
        "name": {
          "type": "string",
          "description": "The name of the bill (e.g., Mortgage, Electricity)."
        },
        "amount": {
          "type": "number",
          "description": "The amount of the bill in GBP."
        },
        "paymentDate": {
          "type": "number",
          "description": "The day of the month the bill is due (1-31)."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "amount",
        "paymentDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Uses path-based ownership, ensuring only the authenticated user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bills/{billId}",
        "definition": {
          "entityName": "Bill",
          "schema": {
            "$ref": "#/backend/entities/Bill"
          },
          "description": "Stores bills associated with a user. The userId is embedded in the path, ensuring that a user can only access bills associated with their own ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "billId",
              "description": "The unique identifier of the bill."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to securely store user data and bill information for the BalanceView application. Prioritizing Authorization Independence and DBAC principles, the design avoids hierarchical `get()` calls in security rules. Path-based ownership is used for private user data.\n\n*   `/users/{userId}`: Stores user profiles. This collection uses path-based ownership, meaning only the authenticated user can access their own profile.\n*   `/users/{userId}/bills/{billId}`: Stores bills associated with a user.  The `userId` is embedded in the path, ensuring that a user can only access bills associated with their own user ID. This structure facilitates secure list operations, ensuring that a user can only list bills that they own. No denormalization is needed here as authorization context (userId) can be derived from path\n\nThis structure enables simple and robust security rules based solely on `request.auth.uid` and path-based ownership, enhancing the overall security and debuggability of the application."
  }
}